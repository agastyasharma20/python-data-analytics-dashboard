{% extends "base.html" %}
{% block content %}

<div class="card">
    <h2>Dashboard Overview</h2>

    <!-- Filter -->
    <form method="get">
        <input
            name="category"
            placeholder="Filter by category"
            value="{{ selected_category or '' }}"
        >
        <button type="submit">Apply Filter</button>
    </form>

    <br>

    {% if summary %}
        <div class="stats">
            <b>Average Score:</b> {{ summary.average_score }}
        </div>

        <div id="barChart"></div>
        <div id="pieChart"></div>
        <div id="trendChart"></div>

        <script>
            const categories = {{ summary.categories | tojson }};
            const counts = {{ summary.counts | tojson }};
            const trendX = {{ summary.trend_x | tojson }};
            const trendY = {{ summary.trend_y | tojson }};

            Plotly.newPlot('barChart', [{
                x: categories,
                y: counts,
                type: 'bar'
            }], { title: 'Category Distribution' });

            Plotly.newPlot('pieChart', [{
                labels: categories,
                values: counts,
                type: 'pie'
            }], { title: 'Category Share (%)' });

            Plotly.newPlot('trendChart', [{
                x: trendX,
                y: trendY,
                mode: 'lines+markers',
                type: 'scatter'
            }], { title: 'Score Trend Over Time' });
        </script>

    {% else %}
        <p>No data available for this filter.</p>
    {% endif %}
<a href="/export{% if selected_category %}?category={{ selected_category }}{% endif %}"
   class="link">⬇ Export CSV</a>

    <a href="/" class="link">➕ Add More Data</a>
</div>

{% endblock %}
